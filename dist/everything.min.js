"use strict";angular.module("myApp",[]).factory("gameLogic",function(){function a(){return[["X","X","F","","F","X","X"],["X","X","","","","X","X"],["","","","","","",""],["S","S","S","S","S","S","S"],["S","S","S","S","S","S","S"],["X","X","S","S","S","X","X"],["X","X","S","S","S","X","X"]]}function b(a){var b,c,d=0;for(b=0;3>b;b++)for(c=2;5>c;c++)"S"===a[b][c]&&d++;if(9===d)return"S";for(d=0,b=0;7>b;b++)for(c=0;7>c;c++)if("S"===a[b][c]&&(d++,d>8))return"";return"F"}function c(a,b){var c,e,f,g,h=[];if(1===b){for(c=0;7>c;c++)for(e=0;7>e;e++)if("F"===a[c][e])for(f=0;7>f;f++)for(g=0;7>g;g++)try{h.push(d(a,c,e,f,g,b))}catch(i){}}else for(c=0;7>c;c++)for(e=0;7>e;e++)if("S"===a[c][e])for(f=0;7>f;f++)for(g=0;7>g;g++)try{h.push(d(a,c,e,f,g,b))}catch(i){}return h}function d(c,d,h,i,j,k){if(void 0===c&&(c=a()),""!==b(c))throw new Error("Can only make a move if the game is not over!");var l,m=!1;if(1===k){var n=e(c,d,h,i,j);l=n.boardAfterMove,m=n.isJump}else l=f(c,d,h,i,j);var o,p=b(l);if(""!==p)o={endMatch:{endMatchScores:"F"===p?[0,1]:[1,0]}};else if(1===k&&m&&g(l))o={setTurn:{turnIndex:k}};else if(0!==k||g(l))o={setTurn:{turnIndex:1-k}};else{var q,r,s,t,u=!1;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===c[s][t]){q=s,r=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(q+s>6||0>q+s||r+t>6||0>r+t||(q+r)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[q+s][r+t])){u=!0;break}if(!u){var v,w;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===c[s][t]&&(s!==q||t!==r)){v=s,w=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(v+s>6||0>v+s||w+t>6||0>w+t||(v+w)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[v+s][w+t])){u=!0;break}}console.log("not tie yet"),u?o={setTurn:{turnIndex:1-k}}:(o={endMatch:{endMatchScores:[0,0]}},console.log("is tie"))}return[o,{set:{key:"board",value:l}},{set:{key:"delta",value:{rowBefore:d,colBefore:h,rowAfter:i,colAfter:j}}}]}function e(a,b,c,d,e){if("F"!==a[b][c])throw new Error("Please move a fox");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");var f,g,h,i,j=!1,k=!1;for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((c+b)%2===0||0===f||0===g)&&(h=c+2*f,i=b+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+b)/2][(h+c)/2]&&(j=!0,d===i&&e===h&&(k=!0)));if(j===!0&&k===!1)throw new Error("Fox must jump over sheep if possible");if(j===!1){var l,m,n=!1;for(f=0;7>f;f++)for(g=0;7>g;g++)if("F"===a[f][g]&&(f!==b||g!==c)){l=f,m=g;break}for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((m+l)%2===0||0===f||0===g)&&(h=m+2*f,i=l+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+l)/2][(h+m)/2]&&(n=!0));if(n===!0)throw new Error("Should move the fox with jump possibility");if((c+b)%2===0&&(Math.abs(d-b)+Math.abs(e-c)>2||2===Math.abs(d-b)||2===Math.abs(e-c)))throw new Error("Fox must move to adjacent vertices");if((c+b)%2!==0&&Math.abs(d-b)+Math.abs(e-c)!==1)throw new Error("Fox must move to adjacent vertices")}var o=angular.copy(a);return o[d][e]="F",o[b][c]="",(2==Math.abs(d-b)||2==Math.abs(e-c))&&(o[(d+b)/2][(e+c)/2]=""),{boardAfterMove:o,isJump:k}}function f(a,b,c,d,e){if("S"!==a[b][c])throw new Error("Please move a sheep");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");if(d!==b&&d!==b-1||Math.abs(e-c)>1)throw new Error("Sheep must move to adjacent vertices and cannot back up");if(1==Math.abs(d-b)&&1==Math.abs(e-c))throw new Error("Sheep cannot move diagonally");var f=angular.copy(a);return f[d][e]="S",f[b][c]="",f}function g(a){var b,c,d,e,f,g,h=!1;for(d=0;7>d;d++)for(e=0;7>e;e++)if("F"===a[d][e]){b=d,c=e;break}for(d=-1;2>d;d++)for(e=-1;2>e;e++)(0!==d||0!==e)&&((c+b)%2===0||0===d||0===e)&&(f=c+2*d,g=b+2*e,f>-1&&7>f&&g>-1&&7>g&&""===a[g][f]&&"S"===a[(g+b)/2][(f+c)/2]&&(h=!0));if(h===!1){var i,j;for(d=0;7>d;d++)for(e=0;7>e;e++)if("F"===a[d][e]&&(d!==b||e!==c)){i=d,j=e;break}for(d=-1;2>d;d++)for(e=-1;2>e;e++)(0!==d||0!==e)&&((j+i)%2===0||0===d||0===e)&&(f=j+2*d,g=i+2*e,f>-1&&7>f&&g>-1&&7>g&&""===a[g][f]&&"S"===a[(g+i)/2][(f+j)/2]&&(h=!0))}return h}function h(a){var b=a.move,c=a.turnIndexBeforeMove,e=a.stateBeforeMove;try{{var f=b[2].set.value,g=f.rowBefore,h=f.colBefore,i=f.rowAfter,j=f.colAfter,k=e.board;d(k,g,h,i,j,c)}}catch(l){return!1}return!0}return{getInitialBoard:a,getPossibleMoves:c,createMove:d,isMoveOk:h}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","stateService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f,g){function h(){var b=f.getPossibleMoves(a.board,a.turnIndex);0!==b.length&&(a.randomMove=b[Math.floor(Math.random()*b.length)],a.justHasRandomMove=!0,d.makeMove(a.randomMove))}function i(b){a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta;var d=!0;void 0===a.board&&(a.board=f.getInitialBoard(),d=!1,j()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,d&&k(),a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(h,500))}function j(){a.uiState=[];var b,c,d={content:-1,isSelected:!1},e=f.getInitialBoard();for(b=0;7>b;b++)for(c=0;7>c;c++)if(0===c&&a.uiState.push([]),"F"===e[b][c]){var g=angular.copy(d);g.content=1,a.uiState[b][c]=g}else if("S"===e[b][c]){var h=angular.copy(d);h.content=0,a.uiState[b][c]=h}else a.uiState[b][c]=d}function k(){for(var c=0;7>c;c++)for(var d=0;7>d;d++){var e=a.board[c][d],f=a.uiState[c][d],g={content:"S"===e?0:"F"===e?1:-1,isSelected:1===a.isSecondClick?f.isSelected:!1};a.uiState[c][d]=g}a.isSecondClick=0,b.info(a.justHasRandomMove);for(var c=0;7>c;c++)for(var d=0;7>d;d++)b.info(a.uiState[c][d].content)}g.setWidthToHeight(.666666667),a.randomMove,a.justHasRandomMove=!1,a.isFirstClick=!0,a.isSecondClick=0,a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol,a.getSquare=function(b,c){return a.uiState[b][c]},window.e2e_test_stateService=e,a.cellClicked=function(c,e){if(b.info(["Clicked on cell:",c,e]),a.isYourTurn){var g=1===a.turnIndex?"F":"S",h=1===a.turnIndex?"S":"F";if(a.board[c][e]===g||!a.isFirstClick){if(a.board[c][e]===h&&!a.isFirstClick)return a.isFirstClick=!0,void(a.uiState[a.firstClickRow][a.firstClickCol].isSelected=!1);if(a.isFirstClick||!a.isFirstClick&&a.board[a.firstClickRow][a.firstClickCol]===a.board[c][e])return a.isFirstClick||(a.uiState[a.firstClickRow][a.firstClickCol].isSelected=!1),a.firstClickRow=c,a.firstClickCol=e,a.uiState[c][e].isSelected=!0,a.isFirstClick=!1,void(a.isSecondClick=1);try{a.secondClickRow=c,a.secondClickCol=e;var i=f.createMove(a.board,a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol,a.turnIndex);a.isFirstClick=!0,a.isSecondClick=2,d.makeMove(i)}catch(j){return void b.info(["Invalid move:",a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol])}}}},d.setGame({gameDeveloperEmail:"zangwz@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:i})}]);
//# sourceMappingURL=everything.min.js.map