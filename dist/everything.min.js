"use strict";angular.module("myApp",[]).factory("gameLogic",function(){function a(){return[["X","X","F","","F","X","X"],["X","X","","","","X","X"],["","","","","","",""],["S","S","S","S","S","S","S"],["S","S","S","S","S","S","S"],["X","X","S","S","S","X","X"],["X","X","S","S","S","X","X"]]}function b(a){var b,c,d=0;for(b=0;3>b;b++)for(c=2;5>c;c++)"S"===a[b][c]&&d++;if(9===d)return"S";for(d=0,b=0;7>b;b++)for(c=0;7>c;c++)if("S"===a[b][c]&&(d++,d>8))return"";return"F"}function c(a,b){var c,e,f,g,h=[];if(1===b){for(c=0;7>c;c++)for(e=0;7>e;e++)if("F"===a[c][e])for(f=0;7>f;f++)for(g=0;7>g;g++)try{h.push(d(a,c,e,f,g,b))}catch(i){}}else for(c=0;7>c;c++)for(e=0;7>e;e++)if("S"===a[c][e])for(f=0;7>f;f++)for(g=0;7>g;g++)try{h.push(d(a,c,e,f,g,b))}catch(i){}return h}function d(c,d,h,i,j,k){if(void 0===c&&(c=a()),""!==b(c))throw new Error("Can only make a move if the game is not over!");var l,m=!1;if(1===k){var n=e(c,d,h,i,j);l=n.boardAfterMove,m=n.isJump}else l=f(c,d,h,i,j);var o,p=b(l);if(""!==p)o={endMatch:{endMatchScores:"F"===p?[0,1]:[1,0]}};else if(1===k&&m&&g(l))o={setTurn:{turnIndex:k}};else if(0!==k||g(l))o={setTurn:{turnIndex:1-k}};else{var q,r,s,t,u=!1;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===c[s][t]){q=s,r=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(q+s>6||0>q+s||r+t>6||0>r+t||(q+r)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[q+s][r+t])){u=!0;break}if(!u){var v,w;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===c[s][t]&&(s!==q||t!==r)){v=s,w=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(v+s>6||0>v+s||w+t>6||0>w+t||(v+w)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[v+s][w+t])){u=!0;break}}console.log("not tie yet"),u?o={setTurn:{turnIndex:1-k}}:(o={endMatch:{endMatchScores:[0,0]}},console.log("is tie"))}return[o,{set:{key:"board",value:l}},{set:{key:"delta",value:{rowBefore:d,colBefore:h,rowAfter:i,colAfter:j}}}]}function e(a,b,c,d,e){if("F"!==a[b][c])throw new Error("Please move a fox");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");var f,g,h,i,j=!1,k=!1;for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((c+b)%2===0||0===f||0===g)&&(h=c+2*f,i=b+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+b)/2][(h+c)/2]&&(j=!0,d===i&&e===h&&(k=!0)));if(j===!0&&k===!1)throw new Error("Fox must jump over sheep if possible");if(j===!1){var l,m,n=!1;for(f=0;7>f;f++)for(g=0;7>g;g++)if("F"===a[f][g]&&(f!==b||g!==c)){l=f,m=g;break}for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((m+l)%2===0||0===f||0===g)&&(h=m+2*f,i=l+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+l)/2][(h+m)/2]&&(n=!0));if(n===!0)throw new Error("Should move the fox with jump possibility");if((c+b)%2===0&&(Math.abs(d-b)+Math.abs(e-c)>2||2===Math.abs(d-b)||2===Math.abs(e-c)))throw new Error("Fox must move to adjacent vertices");if((c+b)%2!==0&&Math.abs(d-b)+Math.abs(e-c)!==1)throw new Error("Fox must move to adjacent vertices")}var o=angular.copy(a);return o[d][e]="F",o[b][c]="",(2==Math.abs(d-b)||2==Math.abs(e-c))&&(o[(d+b)/2][(e+c)/2]=""),{boardAfterMove:o,isJump:k}}function f(a,b,c,d,e){if("S"!==a[b][c])throw new Error("Please move a sheep");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");if(d!==b&&d!==b-1||Math.abs(e-c)>1)throw new Error("Sheep must move to adjacent vertices and cannot back up");if(1==Math.abs(d-b)&&1==Math.abs(e-c))throw new Error("Sheep cannot move diagonally");var f=angular.copy(a);return f[d][e]="S",f[b][c]="",f}function g(a){var b,c,d,e,f,g,h=!1;for(d=0;7>d;d++)for(e=0;7>e;e++)if("F"===a[d][e]){b=d,c=e;break}for(d=-1;2>d;d++)for(e=-1;2>e;e++)(0!==d||0!==e)&&((c+b)%2===0||0===d||0===e)&&(f=c+2*d,g=b+2*e,f>-1&&7>f&&g>-1&&7>g&&""===a[g][f]&&"S"===a[(g+b)/2][(f+c)/2]&&(h=!0));if(h===!1){var i,j;for(d=0;7>d;d++)for(e=0;7>e;e++)if("F"===a[d][e]&&(d!==b||e!==c)){i=d,j=e;break}for(d=-1;2>d;d++)for(e=-1;2>e;e++)(0!==d||0!==e)&&((j+i)%2===0||0===d||0===e)&&(f=j+2*d,g=i+2*e,f>-1&&7>f&&g>-1&&7>g&&""===a[g][f]&&"S"===a[(g+i)/2][(f+j)/2]&&(h=!0))}return h}function h(a){var b=a.move,c=a.turnIndexBeforeMove,e=a.stateBeforeMove;try{{var f=b[2].set.value,g=f.rowBefore,h=f.colBefore,i=f.rowAfter,j=f.colAfter,k=e.board;d(k,g,h,i,j,c)}}catch(l){return!1}return!0}return{getInitialBoard:a,getPossibleMoves:c,createMove:d,isMoveOk:h}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","$rootScope","gameService","stateService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f,g,h){function i(){var b=g.getPossibleMoves(a.board,a.turnIndex);0!==b.length&&(a.randomMove=b[Math.floor(Math.random()*b.length)],a.justHasRandomMove=!0,e.makeMove(a.randomMove))}function j(b){a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta;var d=!0;void 0===a.board&&(a.board=g.getInitialBoard(),d=!1,k()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,d&&l(),a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(i,1200))}function k(){a.uiState=[];var b,c,d={content:-1,isSelected:!1},e=g.getInitialBoard();for(b=0;7>b;b++)for(c=0;7>c;c++)if(0===c&&a.uiState.push([]),"F"===e[b][c]){var f=angular.copy(d);f.content=1,a.uiState[b][c]=f}else if("S"===e[b][c]){var h=angular.copy(d);h.content=0,a.uiState[b][c]=h}else a.uiState[b][c]=d;a.justInitialize=!0}function l(){for(var c=0;7>c;c++)for(var d=0;7>d;d++){var e=a.board[c][d],f=a.uiState[c][d],g={content:"S"===e?0:"F"===e?1:-1,isSelected:1===a.isSecondClick?f.isSelected:!1};a.uiState[c][d]=g}a.justInitialize=!1,a.isSecondClick=0,b.info(a.justHasRandomMove);var h=a.delta.rowAfter,i=a.delta.colAfter,j=document.getElementById("e2e_test_img_"+h+"x"+i);j.className="enlarge1"===j.className?"enlarge2":"enlarge1",b.info("current"+j.className);for(var c=(a.delta.rowBefore,a.delta.colBefore,0);7>c;c++)for(var d=0;7>d;d++)b.info(a.uiState[c][d].content);b.info("turnIndex "+a.turnIndex),b.info("current"+j.className)}function m(c,d,e){var f,g,h=d-r.offsetLeft,i=e-r.offsetTop;if(0>h||0>i||h>=r.clientWidth||i>=r.clientHeight){if(!v)return;var j=o();n({top:i-j.height/2,left:h-j.width/2})}else{var g=Math.floor(t*h/r.clientWidth),f=Math.floor(s*(i-.12*r.clientHeight)/r.clientHeight/.75);if("touchstart"!==c||u||(b.info("turnIndex "+a.turnIndex),(""!=a.board[f][g]||"X"!=a.board[f][g])&&(u={row:f,col:g},b.info("firstrow"+u.row),v=document.getElementById("e2e_test_img_"+f+"x"+g),b.info("draggingPiece"+v),v.style["z-index"]=++w,b.info("style"+v.style["z-index"]))),!v)return;if("touchend"===c){var k=u,l={row:f,col:g};0===a.turnIndex?(k.row>l.row&&(l.row=k.row-1),k.col<l.col&&(l.col=k.col+1),k.col>l.col&&(l.col=k.col-1)):(l.row===k.row&&l.col<k.col&&(l.col="S"===a.board[l.row][k.col-1]?k.col-2:k.col-1),l.row===k.row&&l.col>k.col&&(l.col="S"===a.board[l.row][k.col+1]?k.col+2:k.col+1),l.col===k.col&&l.row<k.row&&(l.row="S"===a.board[k.row-1][k.col]?k.row-2:k.row-1),l.col===k.col&&l.row>k.row&&(l.row="S"===a.board[k.row+1][k.col]?k.row+2:k.row+1),l.row<k.row&&l.col<k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row-1][k.col-1]?(l.row=k.row-2,l.col=k.col-2):(l.row=k.row-1,l.col=k.col-1)),l.row<k.row&&l.col>k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row-1][k.col+1]?(l.row=k.row-2,l.col=k.col+2):(l.row=k.row-1,l.col=k.col+1)),l.row>k.row&&l.col<k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row+1][k.col-1]?(l.row=k.row+2,l.col=k.col-2):(l.row=k.row+1,l.col=k.col-1)),l.row>k.row&&l.col>k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row+1][k.col+1]?(l.row=k.row+2,l.col=k.col+2):(l.row=k.row+1,l.col=k.col+1))),q(k,l)}else{var j=o();n({top:i-.12*r.clientHeight-j.height/2,left:h-j.width/2})}}("touchend"===c||"touchcancel"===c||"touchleave"===c)&&(n(p(u.row,u.col)),u=null,v=null)}function n(a){var b=p(u.row,u.col);v.style.left=a.left-b.left+"px",v.style.top=a.top-b.top+"px"}function o(){return{width:r.clientWidth/t,height:.75*r.clientHeight/s}}function p(a,b){var c=o();return{top:a*c.height,left:b*c.width}}function q(c,f){d.$apply(function(){try{b.info("turnIndex "+a.turnIndex);var d=g.createMove(a.board,c.row,c.col,f.row,f.col,a.turnIndex);e.makeMove(d)}catch(h){return b.info(["Invalid move:",c.row,c.col,f.row,f.col]),b.info(u),void b.info(u)}})}h.setWidthToHeight(.666666667),a.randomMove,a.justHasRandomMove=!1,a.justInitialize=!1,a.isFirstClick=!0,a.isSecondClick=0,a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol,a.getSquare=function(b,c){return a.uiState[b][c]};var r=document.getElementById("gameArea");b.info("clientWidth"+r.clientWidth),b.info("clientHeight"+r.clientHeight);var s=7,t=7,u=null,v=null,w=61;window.handleDragEvent=m,window.e2e_test_stateService=f,b.info("turnIndex "+a.turnIndex),a.cellClicked=function(c,d){if(b.info(["Clicked on cell:",c,d]),a.isYourTurn){b.info("turnIndex "+a.turnIndex);var f=1===a.turnIndex?"F":"S",h=1===a.turnIndex?"S":"F";if(a.board[c][d]===f||!a.isFirstClick){if(a.board[c][d]===h&&!a.isFirstClick)return a.isFirstClick=!0,void(a.uiState[a.firstClickRow][a.firstClickCol].isSelected=!1);if(a.isFirstClick||!a.isFirstClick&&a.board[a.firstClickRow][a.firstClickCol]===a.board[c][d])return a.isFirstClick||(a.uiState[a.firstClickRow][a.firstClickCol].isSelected=!1),a.firstClickRow=c,a.firstClickCol=d,a.uiState[c][d].isSelected=!0,a.isFirstClick=!1,void(a.isSecondClick=1);try{a.secondClickRow=c,a.secondClickCol=d;var i=g.createMove(a.board,a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol,a.turnIndex);a.isFirstClick=!0,a.isSecondClick=2,e.makeMove(i)}catch(j){return void b.info(["Invalid move:",a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol])}}}},e.setGame({gameDeveloperEmail:"zangwz@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:j})}]);
//# sourceMappingURL=everything.min.js.map