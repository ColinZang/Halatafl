"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]).factory("gameLogic",function(){function a(){return[["X","X","F","","F","X","X"],["X","X","","","","X","X"],["","","","","","",""],["S","S","S","S","S","S","S"],["S","S","S","S","S","S","S"],["X","X","S","S","S","X","X"],["X","X","S","S","S","X","X"]]}function b(a){var b,c,d=0;for(b=0;3>b;b++)for(c=2;5>c;c++)"S"===a[b][c]&&d++;if(9===d)return"S";for(d=0,b=0;7>b;b++)for(c=0;7>c;c++)if("S"===a[b][c]&&(d++,d>8))return"";return"F"}function c(a,b){var c=[];if(1===b){for(var e=0;7>e;e++)for(var f=0;7>f;f++)if("F"===a[e][f])for(var g=0;7>g;g++)for(var h=0;7>h;h++)try{c.push(d(a,e,f,g,h,b))}catch(i){}}else for(var e=0;7>e;e++)for(var f=0;7>f;f++)if("S"===a[e][f])for(var g=0;7>g;g++)for(var h=0;7>h;h++)try{c.push(d(a,e,f,g,h,b))}catch(i){}return c}function d(c,d,h,i,j,k){if(void 0===c&&(c=a()),""!==b(c))throw new Error("Can only make a move if the game is not over!");var l,m=!1;if(1===k){var n=e(c,d,h,i,j);l=n.boardAfterMove,m=n.isJump}else l=f(c,d,h,i,j);var o,p=b(l);if(""!==p)o={endMatch:{endMatchScores:"F"===p?[0,1]:[1,0]}};else if(1===k&&m&&g(l,i,j))o={setTurn:{turnIndex:k}};else if(0!==k||g(l,i,j))o={setTurn:{turnIndex:1-k}};else{var q,r,s,t,u=!1;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===c[s][t]){q=s,r=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(q+s>6||0>q+s||r+t>6||0>r+t||(q+r)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[q+s][r+t])){u=!0;break}if(!u){var v,w;for(s=0;7>s;s++)for(t=0;7>t;t++)if("F"===c[s][t]&&(s!==q||t!==r)){v=s,w=t;break}for(s=-1;2>s;s++)for(t=-1;2>t;t++)if(!(v+s>6||0>v+s||w+t>6||0>w+t||(v+w)%2!==0&&Math.abs(s)+Math.abs(t)===2||""!==l[v+s][w+t])){u=!0;break}}console.log("not tie yet"),u?o={setTurn:{turnIndex:1-k}}:(o={endMatch:{endMatchScores:[0,0]}},console.log("is tie"))}return[o,{set:{key:"board",value:l}},{set:{key:"delta",value:{rowBefore:d,colBefore:h,rowAfter:i,colAfter:j}}}]}function e(a,b,c,d,e){if("F"!==a[b][c])throw new Error("Please move a fox");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");var f,g,h,i,j=!1,k=!1;for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((c+b)%2===0||0===f||0===g)&&(h=c+2*f,i=b+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+b)/2][(h+c)/2]&&(j=!0,d===i&&e===h&&(k=!0)));if(j===!0&&k===!1)throw new Error("Fox must jump over sheep if possible");if(j===!1){var l,m,n=!1;for(f=0;7>f;f++)for(g=0;7>g;g++)if("F"===a[f][g]&&(f!==b||g!==c)){l=f,m=g;break}for(f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((m+l)%2===0||0===f||0===g)&&(h=m+2*f,i=l+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+l)/2][(h+m)/2]&&(n=!0));if(n===!0)throw new Error("Should move the fox with jump possibility");if((c+b)%2===0&&(Math.abs(d-b)+Math.abs(e-c)>2||2===Math.abs(d-b)||2===Math.abs(e-c)))throw new Error("Fox must move to adjacent vertices");if((c+b)%2!==0&&Math.abs(d-b)+Math.abs(e-c)!==1)throw new Error("Fox must move to adjacent vertices")}var o=angular.copy(a);return o[d][e]="F",o[b][c]="",(2==Math.abs(d-b)||2==Math.abs(e-c))&&(o[(d+b)/2][(e+c)/2]=""),{boardAfterMove:o,isJump:k}}function f(a,b,c,d,e){if("S"!==a[b][c])throw new Error("Please move a sheep");if("X"===a[d][e])throw new Error("Invalid move");if(""!==a[d][e])throw new Error("The vertex is occupied");if(d!==b&&d!==b-1||Math.abs(e-c)>1)throw new Error("Sheep must move to adjacent vertices and cannot back up");if(1==Math.abs(d-b)&&1==Math.abs(e-c))throw new Error("Sheep cannot move diagonally");var f=angular.copy(a);return f[d][e]="S",f[b][c]="",f}function g(a,b,c){var d,e,f,g,h,i,j=!1;for(d=b,e=c,f=-1;2>f;f++)for(g=-1;2>g;g++)(0!==f||0!==g)&&((e+d)%2===0||0===f||0===g)&&(h=e+2*f,i=d+2*g,h>-1&&7>h&&i>-1&&7>i&&""===a[i][h]&&"S"===a[(i+d)/2][(h+e)/2]&&(j=!0));return j}function h(a){var b=a.move,c=a.turnIndexBeforeMove,e=a.stateBeforeMove;try{{var f=b[2].set.value,g=f.rowBefore,h=f.colBefore,i=f.rowAfter,j=f.colAfter,k=e.board;d(k,g,h,i,j,c)}}catch(l){return!1}return!0}return{getInitialBoard:a,getPossibleMoves:c,createMove:d,isMoveOk:h}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","$rootScope","gameService","stateService","gameLogic","resizeGameAreaService","dragAndDropService",function(a,b,c,d,e,f,g,h,i){function j(){var b=t(a.board,a.turnIndex);e.makeMove(b)}function k(d){a.board=d.stateAfterMove.board,a.delta=d.stateAfterMove.delta;var e=!0;void 0===a.board&&(a.board=g.getInitialBoard(),e=!1,m()),a.isYourTurn=d.turnIndexAfterMove>=0&&d.yourPlayerIndex===d.turnIndexAfterMove,a.turnIndex=d.turnIndexAfterMove,e&&n(),a.isYourTurn&&""===d.playersInfo[d.yourPlayerIndex].playerId&&(a.isYourTurn=!1,a.computerMove=!0,b.info(a.computerMove),c(j,1200),c(l,1e3),b.info(a.computerMove))}function l(){a.computerMove=!1}function m(){a.uiState=[];var b,c,d={content:-1,isSelected:!1},e=g.getInitialBoard();for(b=0;7>b;b++)for(c=0;7>c;c++)if(0===c&&a.uiState.push([]),"F"===e[b][c]){var f=angular.copy(d);f.content=1,a.uiState[b][c]=f}else if("S"===e[b][c]){var h=angular.copy(d);h.content=0,a.uiState[b][c]=h}else a.uiState[b][c]=d;a.justInitialize=!0}function n(){for(var c=0;7>c;c++)for(var d=0;7>d;d++){var e=a.board[c][d],f=a.uiState[c][d],g={content:"S"===e?0:"F"===e?1:-1,isSelected:1===a.isSecondClick?f.isSelected:!1};a.uiState[c][d]=g}a.justInitialize=!1,a.isSecondClick=0,b.info(a.justHasRandomMove);var h=a.delta.rowAfter,i=a.delta.colAfter,j=document.getElementById("e2e_test_img_"+h+"x"+i);j.className="enlarge1"===j.className?"enlarge2":"enlarge1",b.info("current"+j.className);for(var c=(a.delta.rowBefore,a.delta.colBefore,0);7>c;c++)for(var d=0;7>d;d++)b.info(a.uiState[c][d].content);b.info("turnIndex "+a.turnIndex),b.info("current"+j.className)}function o(c,d,e){if(b.info(a.computerMove),a.computerMove!==!0){var f,g,h=d-x.offsetLeft,i=e-x.offsetTop;if(0>h||0>i||h>=x.clientWidth||i>=x.clientHeight){if(!B)return;var j=q();p({top:i-j.height/2,left:h-j.width/2})}else{var g=Math.floor(z*h/x.clientWidth),f=Math.floor(y*(i-.12*x.clientHeight)/x.clientHeight/.75);if("touchstart"!==c||A||(b.info("turnIndex "+a.turnIndex),(""!=a.board[f][g]||"X"!=a.board[f][g])&&(A={row:f,col:g},b.info("firstrow"+A.row),B=document.getElementById("e2e_test_img_"+f+"x"+g),b.info("draggingPiece"+B),B.style["z-index"]=++C,b.info("style"+B.style["z-index"]))),!B)return;if("touchend"===c){var k=A,l={row:f,col:g};0===a.turnIndex?(k.row>l.row&&(l.row=k.row-1),k.col<l.col&&(l.col=k.col+1),k.col>l.col&&(l.col=k.col-1)):(l.row===k.row&&l.col<k.col&&(l.col="S"===a.board[l.row][k.col-1]?k.col-2:k.col-1),l.row===k.row&&l.col>k.col&&(l.col="S"===a.board[l.row][k.col+1]?k.col+2:k.col+1),l.col===k.col&&l.row<k.row&&(l.row="S"===a.board[k.row-1][k.col]?k.row-2:k.row-1),l.col===k.col&&l.row>k.row&&(l.row="S"===a.board[k.row+1][k.col]?k.row+2:k.row+1),l.row<k.row&&l.col<k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row-1][k.col-1]?(l.row=k.row-2,l.col=k.col-2):(l.row=k.row-1,l.col=k.col-1)),l.row<k.row&&l.col>k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row-1][k.col+1]?(l.row=k.row-2,l.col=k.col+2):(l.row=k.row-1,l.col=k.col+1)),l.row>k.row&&l.col<k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row+1][k.col-1]?(l.row=k.row+2,l.col=k.col-2):(l.row=k.row+1,l.col=k.col-1)),l.row>k.row&&l.col>k.col&&Math.abs(l.row-k.row)===Math.abs(l.col-k.col)&&("S"===a.board[k.row+1][k.col+1]?(l.row=k.row+2,l.col=k.col+2):(l.row=k.row+1,l.col=k.col+1))),s(k,l)}else{var j=q();p({top:i-.12*x.clientHeight-j.height/2,left:h-j.width/2})}}("touchend"===c||"touchcancel"===c||"touchleave"===c)&&(p(r(A.row,A.col)),A=null,B=null)}}function p(a){var b=r(A.row,A.col);B.style.left=a.left-b.left+"px",B.style.top=a.top-b.top+"px"}function q(){return{width:x.clientWidth/z,height:.75*x.clientHeight/y}}function r(a,b){var c=q();return{top:a*c.height,left:b*c.width}}function s(c,f){d.$apply(function(){try{b.info("turnIndex "+a.turnIndex);var d=g.createMove(a.board,c.row,c.col,f.row,f.col,a.turnIndex);e.makeMove(d)}catch(h){return b.info(["Invalid move:",c.row,c.col,f.row,f.col]),b.info(A),void b.info(A)}})}function t(a,b){var c=g.getPossibleMoves(a,b);if(0===b&&0!==c.length){var d=c[Math.floor(Math.random()*c.length)];return d}var e;try{if(D)for(var f=0;f<c.length;f++)(c[f][2].set.value.rowBefore!==E||c[f][2].set.value.colBefore!==F)&&c.splice(f,1);if(1===c.length)e=c[0];else if(v(c[0])){var h=1;e=c[0];for(var f=0;f<c.length;f++){var i=1+u(c[f]);i>h&&(h=i,e=c[f])}}else{var h=0;e=c[0];for(var f=0;f<c.length;f++){var i=u(c[f]);i>h&&(h=i,e=c[f])}if(0===h){for(var j=0,f=0;f<c.length;f++){var i=w(c[f]);i>j&&(j=i,e=c[f])}if(0===j)if(c[0][2].set.value.rowBefore<3){for(var f=0;f<c.length;f++)if(c[f][2].set.value.rowBefore<c[f][2].set.value.rowAfter){e=c[f];break}}else for(var f=0;f<c.length;f++)if(c[f][2].set.value.rowBefore>c[f][2].set.value.rowAfter){e=c[f];break}}}}catch(k){e=c[0]}if(v(e)){var f,l=g.getPossibleMoves(e[1].set.value,1);for(f=0;f<l.length;f++)if(v(l[f])&&l[f][2].set.value.rowBefore===e[2].set.value.rowAfter&&l[f][2].set.value.colBefore===e[2].set.value.colAfter){D=!0,E=e[2].set.value.rowAfter,F=e[2].set.value.colAfter;break}console.log("i is "+f),f===l.length&&(D=!1)}else D=!1;return e}function u(a){for(var b=g.getPossibleMoves(a[1].set.value,1),c=0;c<b.length;c++)(b[c][2].set.value.rowBefore!==a[2].set.value.rowAfter||b[c][2].set.value.colBefore!==a[2].set.value.colAfter)&&b.splice(c,1);if(0===b.length)return 0;if(!v(b[0]))return 0;if(1===b.length&&v(b[0]))return 1;for(var d=0,a=b[0],c=0;c<b.length;c++){var e=u(b[c]);e>d&&(d=e,a=b[c])}return 1+d}function v(a){var b=a[2].set.value.rowBefore,c=a[2].set.value.rowAfter,d=a[2].set.value.colBefore,e=a[2].set.value.colAfter;return 2===Math.abs(b-c)||2===Math.abs(d-e)?!0:!1}function w(a){for(var b=a[2].set.value.rowAfter,c=a[2].set.value.colAfter,d=a[1].set.value,e=0,f=-1;2>f;f++)for(var g=-1;2>g;g++)(0!==f||0!==g)&&(0>b+f||b+f>6||0>c+g||c+g>6||"S"===d[b+f][c+g]&&(e++,console.log("count: ",b+f,c+g)));return e}h.setWidthToHeight(.666666667),a.randomMove,a.justHasRandomMove=!1,a.computerMove=!1,a.justInitialize=!1,a.isFirstClick=!0,a.isSecondClick=0,a.firstClickRow,a.firstClickCol,a.secondClickRow,a.secondClickCol,a.getSquare=function(b,c){return a.uiState[b][c]};var x=document.getElementById("gameArea");b.info("clientWidth"+x.clientWidth),b.info("clientHeight"+x.clientHeight);var y=7,z=7,A=null,B=null,C=61;i.addDragListener("gameArea",o),a.countArrivedSheep=function(){for(var b=0,c=0;3>c;c++)for(var d=2;5>d;d++)"S"===a.board[c][d]&&b++;return b},a.countEatenSheep=function(){for(var b=0,c=0;7>c;c++)for(var d=0;7>d;d++)"S"===a.board[c][d]&&b++;return 20-b};var D=!1,E=0,F=0;window.e2e_test_stateService=f,e.setGame({gameDeveloperEmail:"zangwz@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:k})}]);
//# sourceMappingURL=everything.min.js.map